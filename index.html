<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Supa Spin Simulator</title>
<style>  
  body {  
    background: #f0f2f5;  
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
    display: flex;  
    flex-direction: row;  
    align-items: flex-start;  
    padding: 30px;  
    min-height: 100vh;  
    margin: 0;  
    gap: 30px;  
  }  
  main {  
    flex: 1;  
    max-width: 600px;
  }  
  h1 {  
    margin-bottom: 10px;  
  }  
  button {  
    padding: 12px 30px;  
    font-size: 18px;  
    border: none;  
    border-radius: 8px;  
    background-color: #111;  
    color: white;  
    cursor: pointer;  
    margin: 10px 10px 10px 0;  
  }  
  #result, #stats, #money, #gears, #luck {  
    margin-top: 20px;  
    width: 100%;  
    padding: 15px 20px;  
    border-radius: 12px;  
    background: white;  
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);  
    font-size: 16px;  
    text-align: center;  
  }  

@import url('https://fonts.googleapis.com/css2?family=Orbitron&family=Playfair+Display&family=Uncial+Antiqua&family=Raleway&family=Great+Vibes&family=Montserrat:wght@700&display=swap');

.rarity-Common        { color: #666; }  
.rarity-Uncommon      { color: #2ecc71; }  
.rarity-Rare          { color: #3498db; }  
.rarity-Steelbone     { color: #76798c; font-weight: bold; }  /* fixed extra # */
.rarity-Epic          { color: #9b59b6; }  
.rarity-Legendary     { color: #f1c40f; }  
.rarity-Mythic        { color: #e67e22; }  
.rarity-Cracked     { color: #888; font-style: italic; }
.rarity-Chipped     { color: #999; }
.rarity-Broken      { color: #666; text-decoration: line-through; }
.rarity-Basic       { color: #aaa; }
.rarity-Dull        { color: #999; font-style: italic; }
.rarity-Tarnished   { color: #bbb; }
.rarity-Dusty       { color: #aaa; }
.rarity-Firm        { color: #666; font-weight: bold; }
.rarity-Polished    { color: #777; }
.rarity-Refined     { color: #8c8c8c; font-weight: bold; }

/* Phantom rarity */
.rarity-Phantom {
  color: slateblue;
  font-family: 'Orbitron', sans-serif;
  animation: pulseFade 2s infinite ease-in-out;
}

/* Divine rarity */
.rarity-Divine {
  color: gold;
  font-family: 'Playfair Display', serif;
  font-weight: 700;
}

/* Pulse animation */
@keyframes pulseFade {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}


/* Steelbone */
.rarity-Steelbone {
  color: #76798c;
  font-weight: bold;
  font-family: 'Orbitron', sans-serif;
  text-shadow: 0 0 8px #a3a7b0;
  animation: glowSteelbone 3s ease-in-out infinite alternate;
}
@keyframes glowSteelbone {
  0%   { text-shadow: 0 0 8px #a3a7b0; }
  100% { text-shadow: 0 0 20px #8a8fa0; }
}

/* Ancient */
.rarity-Ancient {
  color: #d35400;
  font-family: 'Uncial Antiqua', cursive;
  font-weight: 600;
  text-shadow: 0 0 8px #e67e22;
  animation: glowAncient 3.5s ease-in-out infinite alternate;
}
@keyframes glowAncient {
  0%   { text-shadow: 0 0 8px #e67e22; }
  100% { text-shadow: 0 0 18px #f39c12; }
}

/* Celestial */
.rarity-Celestial {
  color: #1abc9c;
  font-family: 'Playfair Display', serif;
  font-style: italic;
  text-shadow: 0 0 10px #16a085;
  animation: glowCelestial 2.5s ease-in-out infinite alternate;
}
@keyframes glowCelestial {
  0%   { text-shadow: 0 0 10px #16a085; }
  100% { text-shadow: 0 0 20px #1abc9c; }
}

/* Above Quantum */

.rarity-Astral {
  color: mediumorchid;
  font-family: 'Raleway', sans-serif;
  font-weight: 700;
  text-shadow: 0 0 12px #b280b2;
  animation: glowAstral 3s ease-in-out infinite alternate;
}
@keyframes glowAstral {
  0%   { text-shadow: 0 0 12px #b280b2; }
  100% { text-shadow: 0 0 24px #c49dcc; }
}

.rarity-Glitched {
  color: darkred;
  font-family: 'Montserrat', sans-serif;
  font-weight: 700;
  text-shadow: 0 0 10px #7b0000;
  animation: glowGlitched 2.5s ease-in-out infinite alternate;
}
@keyframes glowGlitched {
  0%   { text-shadow: 0 0 10px #7b0000; }
  100% { text-shadow: 0 0 22px #a00000; }
}

.rarity-Primordial {
  color: teal;
  font-weight: bold;
  font-family: 'Great Vibes', cursive;
  text-shadow: 0 0 15px #008080;
  animation: glowPrimordial 4s ease-in-out infinite alternate;
}
@keyframes glowPrimordial {
  0%   { text-shadow: 0 0 15px #008080; }
  100% { text-shadow: 0 0 30px #00a0a0; }
}

.rarity-Ethereal {
  color: #a29bfe;
  font-family: 'Raleway', sans-serif;
  font-style: italic;
  font-weight: 600;
  text-shadow: 0 0 14px #8c87ff;
  animation: glowEthereal 3.5s ease-in-out infinite alternate;
}
@keyframes glowEthereal {
  0%   { text-shadow: 0 0 14px #8c87ff; }
  100% { text-shadow: 0 0 28px #b0adff; }
}

.rarity-Reality-Bound {
  color: #8e44ad;
  font-weight: bold;
  font-family: 'Montserrat', sans-serif;
  text-shadow: 0 0 14px #5a2f71;
  animation: glowRealityBound 3s ease-in-out infinite alternate;
}
@keyframes glowRealityBound {
  0%   { text-shadow: 0 0 14px #5a2f71; }
  100% { text-shadow: 0 0 26px #8e44ad; }
}

.rarity-Genesis {
  color: #000;
  background: #fff;
  padding: 2px 6px;
  border-radius: 6px;
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  text-shadow: 0 0 12px #555;
  animation: glowGenesis 4s ease-in-out infinite alternate;
}
@keyframes glowGenesis {
  0%   { text-shadow: 0 0 12px #555; }
  100% { text-shadow: 0 0 24px #888; }
}

  .variant {  
    font-style: italic;  
    margin-left: 5px;  
    padding: 2px 6px;  
    border-radius: 5px;  
    background: #eee;  
    font-weight: 600;  
    user-select: none;  
  }
  /* Variant colors by rarity */
.variant-common {
  color: #7f8c8d; /* greyish */
  font-weight: 600;
  user-select: none;
}

.variant-uncommon {
  color: #27ae60; /* green */
  font-weight: 600;
  user-select: none;
}
/* Base animation keyframes */
@keyframes pulseGlow {
  0% { box-shadow: 0 0 6px currentColor; }
  50% { box-shadow: 0 0 20px currentColor; transform: scale(1.03); }
  100% { box-shadow: 0 0 6px currentColor; }
}

@keyframes colorCycle {
  0%   { filter: hue-rotate(0deg); }
  100% { filter: hue-rotate(360deg); }
}

/* Animated Rarity Styles */

.rarity-Glitched {
  color: darkred;
  font-weight: bold;
  animation: pulseGlow 1.5s infinite;
}

.rarity-Primordial {
  color: teal;
  font-weight: bold;
  animation: pulseGlow 1.6s infinite ease-in-out;
}

.rarity-Ethereal {
  color: #a29bfe;
  font-style: italic;
  animation: colorCycle 3s linear infinite;
}

.rarity-Reality-Bound {
  color: #8e44ad;
  font-weight: bold;
  background: linear-gradient(45deg, #8e44ad, #d0c1f7);
  background-clip: text;
  -webkit-background-clip: text;
  color: transparent;
  animation: colorCycle 4s linear infinite;
}

.rarity-Genesis {
  color: #fff;
  background: linear-gradient(90deg, #000, #ff0, #000);
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: 900;
  animation: pulseGlow 1.2s infinite, colorCycle 5s linear infinite;
}
  /* Sidebar dropdown styling */
  #sidebar {
    width: 250px;
    background: white;
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
  }
  
  #auto-spin-rate {
  margin-top: 10px;
  font-size: 16px;
  color: #333;
}

  label {
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
  }
  #upgrades-panel {
  margin-top: 20px;
  padding: 20px;
  border-radius: 12px;
  background: white;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
.upgrade-box {
  margin-bottom: 15px;
  font-size: 15px;
}
#buy-luck-upgrade {
  margin-top: 8px;
  padding: 6px 12px;
  font-size: 14px;
  border-radius: 6px;
  background: #27ae60;
  color: white;
  border: none;
  cursor: pointer;
}

  select {
    width: 100%;
    font-size: 16px;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    margin-bottom: 15px;
    cursor: pointer;
  }
    #gear-panel {
  width: 300px;
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
}
#inventory-display {
  margin-top: 20px;
  padding: 15px;
  border-radius: 12px;
  background: white;
  box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
}
#rarity-counts {
  font-size: 15px;
  line-height: 1.6;
  text-align: left;
}

.gear-box {
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

.gear-title {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 8px;
}

.gear-progress {
  height: 18px;
  background: #ddd;
  border-radius: 10px;
  overflow: hidden;
  margin: 6px 0;
}

.gear-progress-bar {
  height: 100%;
  background: linear-gradient(to right, #4caf50, #2ecc71);
  width: 0%;
  transition: width 0.3s ease;
  color: white;
  font-size: 12px;
  text-align: center;
  line-height: 18px;
}

.gear-status {
  font-size: 14px;
  margin-top: 5px;
}
/* Floating particle container */

</style>
</head>
<body>
<audio id="bgm-audio" src="ScreenRecording_07-13-2025_16-13-26_1 (1).mp3" loop></audio>
<main>
  <h1>‚ô§ Supa Spin Game ‚ô§</h1>
  <button id="spin-btn">Spin</button>
  <button id="auto-spin-btn" disabled>Auto Spin: OFF</button>

  <div id="result">Your result will appear here.</div>
  <div id="money">Money: 0</div>
  <div id="stats">Total Spins: 0<br>Rarest Pull: N/A</div>
  <div id="luck">Luck Bonus from Gears: 0%</div>
  <div id="auto-spin-rate">Auto Spin Rate: OFF</div>
  <div id="gears">
    <div id="spinBoostDisplay" style="position: fixed; top: 10px; right: 10px; 
  background: rgba(0,0,0,0.6); color: white; padding: 8px 12px; border-radius: 8px;
  font-family: monospace; font-weight: bold; z-index: 1000;">
  Spin Speed Boost: 0%
</div>
    <h3>Gear Status</h3>
    <div id="gear-list">No gears collected yet.</div>
    <div id="gear-description" class="gear-description" style="...">
  Select a gear to see its description.
</div>
    <div id="inventory-display">
      <h3>Your Rarity Inventory</h3>
      <div id="rarity-counts">Nothing pulled yet.</div>
    </div>
  </div>
</main>

<div id="sidebar">
  <input type="text" id="secretCodeInput" placeholder="Enter secret code" />
<button id="secretCodeSubmit">Submit</button>
<div id="secretCodeMessage"></div>
  <div id="upgrades-panel">
  <h3>Upgrades</h3>
  <div class="upgrade-box">
    <strong>Luck Upgrade</strong> (Level <span id="luck-upgrade-level">0</span>)<br>
    Increases base luck by 10% per level.<br>
    <button id="buy-luck-upgrade">Buy (Cost: <span id="luck-upgrade-cost">10,000</span>)</button>
  </div>
</div>
  <label for="rarity-list">All Rarities</label>
  <select id="rarity-list" size="16" readonly>
    <!-- Options populated by JS -->
  </select>
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
  let bgmStarted = false;

  function startBGM() {
    if (!bgmStarted) {
      const audio = document.getElementById("bgm-audio");
      if (audio) {
        audio.volume = 0.3;
        audio.play().catch(err => {
          console.log("Autoplay blocked:", err);
        });
        bgmStarted = true;
      } else {
        console.warn("BGM audio element not found.");
      }
    }
  }

  // Play BGM on first click
  document.addEventListener("click", startBGM, { once: true });

// Create container once
const notificationContainer = document.createElement("div");
notificationContainer.style.position = "fixed";
notificationContainer.style.bottom = "20px";
notificationContainer.style.left = "50%";
notificationContainer.style.transform = "translateX(-50%)";
notificationContainer.style.display = "flex";
notificationContainer.style.flexDirection = "column-reverse";
notificationContainer.style.alignItems = "center";
notificationContainer.style.zIndex = "9999";
document.body.appendChild(notificationContainer);

const notificationTimeouts = new Map();
let fortuneRingNotified = false;

function showNotification(message, color = "#00c8ff", duration = 2500) {
  // Check if notification with same message exists
  let existing = [...notificationContainer.children].find(
    (note) => note.textContent === message
  );

  if (existing) {
    clearTimeout(notificationTimeouts.get(existing));

    const timeoutId = setTimeout(() => {
      existing.style.opacity = "0";
      existing.style.transform = "translateY(-30px)";
      setTimeout(() => {
        existing.remove();
        notificationTimeouts.delete(existing);
      }, 400);
    }, duration);

    notificationTimeouts.set(existing, timeoutId);
    return; // Don't create a new duplicate notification
  }

  // Create new notification
  const note = document.createElement("div");
  note.textContent = message;
  note.style.position = "relative";
  note.style.background = color;
  note.style.color = "#fff";
  note.style.padding = "10px 18px";
  note.style.marginTop = "10px";
  note.style.borderRadius = "10px";
  note.style.fontWeight = "bold";
  note.style.boxShadow = "0 3px 10px rgba(0,0,0,0.3)";
  note.style.fontSize = "15px";
  note.style.opacity = "0";
  note.style.transform = "translateY(-40px)";
  note.style.transition = "all 0.4s ease-out";

  notificationContainer.appendChild(note);

  requestAnimationFrame(() => {
    note.style.opacity = "1";
    note.style.transform = "translateY(0)";
  });

  const timeoutId = setTimeout(() => {
    note.style.opacity = "0";
    note.style.transform = "translateY(-30px)";
    setTimeout(() => {
      note.remove();
      notificationTimeouts.delete(note);
    }, 400);
  }, duration);

  notificationTimeouts.set(note, timeoutId);
}

const rarityDropRates = {
  "Cracked": 1 / 25,
  "Chipped": 1 / 33,
  "Broken": 1 / 40,
  "Basic": 1 / 50,
  "Dull": 1 / 66,
  "Tarnished": 1 / 80,
  "Common": 1 / 100,
  "Dusty": 1 / 133,
  "Uncommon": 1 / 200,
  "Firm": 1 / 333,
  "Polished": 1 / 400,
  "Refined": 1 / 500,
  "Rare": 1 / 1000,
  "Steelbone": 1 / 2000,
  "Epic": 1 / 3333,
  "Legendary": 1 / 10000,
  "Mythic": 1 / 13333,
  "Ancient": 1 / 20000,
  "Celestial": 1 / 50000,
  "Transcendent": 1 / 100000,
  "Omniversal": 1 / 200000,
  "Divine": 1 / 333333,
  "Phantom": 1 / 500000,
  "Quantum": 1 / 1000000,
  "Astral": 1 / 2000000,
  "Primordial": 1 / 200000,
  "Glitched": 1 / 50000000,
  "Reality-Bound": 1 / 90000000,
  "Ethereal": 1 / 106000000,
  "Genesis": 1 / 2000000000
};

const baseRarities = {};
for (const [rarity, dropRate] of Object.entries(rarityDropRates)) {
  baseRarities[rarity] = dropRate;
}

  const variants = {
    "Common": [
      {name:"Rusty", weight: 40},
      {name:"Dusty", weight: 30},
      {name:"Basic", weight: 50},
      {name:"Worn", weight: 20},
      {name:"Scratched", weight: 10},
      {name:"Faded", weight: 35},
      {name:"Plain", weight: 45}
    ],
    "Uncommon": [
      {name:"Polished", weight: 50},
      {name:"Light-Tinted", weight: 25},
      {name:"Improved", weight: 20},
      {name:"Fine", weight: 15},
      {name:"Refined", weight: 10}
    ],
    "Rare": [
      {name:"Shiny", weight: 35},
      {name:"Steel-Plated", weight: 25},
      {name:"Neat", weight: 20},
      {name:"Glow-Edge", weight: 15},
      {name:"Sharp", weight: 10}
    ],
    "Steelbone": [
      {name:"Aegis", weight: 1}
    ],
    "Epic": [
      {name:"Crimson", weight: 30},
      {name:"Shadow-Forged", weight: 20},
      {name:"Holy", weight: 15},
      {name:"Void-Touched", weight: 10},
      {name:"Spiked", weight: 5}
    ],
    "Legendary": [
      {name:"Dragoncore", weight: 25},
      {name:"Arcane-Blade", weight: 20},
      {name:"Royal", weight: 15},
      {name:"Phoenix", weight: 10},
      {name:"Duskborne", weight: 5}
    ],
    "Mythic": [
      {name:"Ethereal", weight: 20},
      {name:"Twilightborn", weight: 15},
      {name:"Spiritforged", weight: 10},
      {name:"Hellfire", weight: 7},
      {name:"Radiant", weight: 3}
    ],
    "Ancient": [
      {name:"Relic-Bound", weight: 20},
      {name:"Time-Worn", weight: 15},
      {name:"Forgotten", weight: 10},
      {name:"Runic", weight: 8},
      {name:"Ruined", weight: 5}
    ],
    "Celestial": [
      {name:"Starforged", weight: 15},
      {name:"Void-Dancer", weight: 10},
      {name:"Cometfall", weight: 8},
      {name:"Skylit", weight: 5},
      {name:"Galaxian", weight: 3}
    ],
    "Transcendent": [
      {name:"God-Touched", weight: 12},
      {name:"Echoed Soul", weight: 8},
      {name:"Lightbane", weight: 6},
      {name:"Fate-Warped", weight: 4},
      {name:"Dimensional", weight: 2}
    ],
    "Omniversal": [
      {name:"Origin", weight: 8},
      {name:"True Form", weight: 5},
      {name:"Undefined", weight: 4},
      {name:"Nullborn", weight: 2},
      {name:"Singularity", weight: 1}
    ],
    "Divine": [
      {name:"Purelight", weight: 10},
      {name:"Heaven's Kiss", weight: 7},
      {name:"Blessed", weight: 5},
      {name:"Immortal", weight: 3},
      {name:"Sacred", weight: 1}
    ],
    "Phantom": [
      {name:"Ghostblade", weight: 10},
      {name:"Wraith-Edge", weight: 7},
      {name:"Spectral", weight: 5},
      {name:"Eclipsed", weight: 3},
      {name:"Soulshadow", weight: 1}
    ],
    "Quantum": [
      {name:"Entangled", weight: 10},
      {name:"Superposed", weight: 7},
      {name:"Uncertain", weight: 5},
      {name:"Collapsed", weight: 3},
      {name:"Photon", weight: 1}
    ],
    "Astral": [
      {name:"Starborn", weight: 10},
      {name:"Celestine", weight: 7},
      {name:"Nebula", weight: 5},
      {name:"Lunar", weight: 3},
      {name:"Solar", weight: 1}
    ],
    "Primordial": [
      {name: "Beyond Time", weight: 0.1},
    ],
    "Glitched": [
      {name:"Corrupted", weight: 10},
      {name:"Broken", weight: 7},
      {name:"Fragmented", weight: 5},
      {name:"Glitched-Out", weight: 3},
      {name:"Bugged", weight: 1}
    ]
  };

  // Gear recipes: each gear requires certain counts of rarities to unlock
  // === Gear Unlock with Money Cost ===
// Modify gearRecipes to include a cost property
const gearRecipes = {
  "Gear 1: Luck Amulet": {
    requirements: { "Common": 100, "Uncommon": 50, "Rare": 10 },
    cost: 10000,
    luckBonus: 1.25,
    spinRateBoost: 0.1
  },

  "Gear 2: Fortune Ring": {
    requirements: { "Uncommon": 100, "Rare": 30, "Epic": 3 },
    cost: 25000,
    luckBonus: 2.5,
    moneyMultiplier: 0.15
  },

  "Gear 3: Eccentric Engine": {
    requirements: { "Rare": 50, "Epic": 20, "Legendary": 2 },
    cost: 75000,
    luckBonus: 4.0,
    rarityUpgradeChance: 0.10,
    spinRateBoost: 0.12
  },

  "Gear 4: Seraphim Booster": {
    requirements: {
      "Epic": 40,
      "Legendary": 15,
      "Mythic": 5,
      "Ancient": 3,
      "Celestial": 2,
      "Transcendent": 1
    },
    cost: 150000,
    luckBonus: 7.5,
    tenthSpinMoneyMultiplier: 5,
    variantRarityMultiplier: 1.1
  },

  "Gear 5: Lightspeed Obliterator": {
    requirements: {
      "Legendary": 20,
      "Mythic": 10,
      "Ancient": 5,
      "Celestial": 3,
      "Transcendent": 2,
      "Omniversal": 1
    },
    cost: 350000,
    luckBonus: 12.5,
    thirdSpinLuckBoost: 12,
    spinRateBoost: 0.25
  },

  "Gear 6: 404 Glitcher": {
    requirements: {
      "Mythic": 15,
      "Ancient": 7,
      "Celestial": 5,
      "Transcendent": 3,
      "Omniversal": 2,
      "Divine": 1
    },
    cost: 750000,
    luckBonus: 30,
    addsGlitchedVariant: true,
    glitchMoneyBoostChance: 0.35,
    glitchMoneyMultiplierPositive: 4,
    glitchMoneyMultiplierNegative: 0.6
  },

  "Gear 7: Omnicore Reactor": {
    requirements: {
      "Ancient": 20,
      "Celestial": 8,
      "Transcendent": 5,
      "Omniversal": 3,
      "Divine": 2,
      "Phantom": 1,
      "Quantum": 1
    },
    cost: 1500000,
    luckBonus: 40,
    moneyMultiplier: 0.8,
    variantLuckBoost: 0.4
  },

  "Gear 8: Eternity Processor": {
    requirements: {
      "Celestial": 15,
      "Transcendent": 8,
      "Omniversal": 5,
      "Divine": 4,
      "Phantom": 2,
      "Quantum": 2,
      "Astral": 1,
      "Primordial": 1
    },
    cost: 3000000,
    spinRateBoost: 0.75,
    tenthSpinMoneyMultiplier: 8,
    variantRarityMultiplier: 1.3
  },

  "Gear 9: Genesis Drive": {
    requirements: {
      "Omniversal": 5,
      "Divine": 5,
      "Phantom": 4,
      "Quantum": 3,
      "Astral": 2,
      "Primordial": 2,
      "Glitched": 1,
      "Ethereal": 1,
      "Reality-Bound": 1
    },
    cost: 7000000,
    luckBonus: 300,
    bonusLuckChance: 0.4,
    moneyMultiplier: 0.4
  },

  "Gear 10: Paradox Core": {
    requirements: {
      "Divine": 10,
      "Phantom": 10,
      "Quantum": 8,
      "Astral": 5,
      "Primordial": 4,
      "Glitched": 3,
      "Ethereal": 2,
      "Reality-Bound": 2,
      "Genesis": 1,
      "Steelbone": 1
    },
    cost: 12000000,
    paradoxSpinChance: 0.04,
    glitchMoneyImmunity: true
  },

  "Gear 11: Godwave Singularity": {
    requirements: {
      "Cracked": 20000,
      "Genesis": 1,
      "Ethereal": 2,
      "Reality-Bound": 2,
      "Astral": 3,
      "Primordial": 4,
      "Glitched": 3,
      "Quantum": 3,
      "Phantom": 3,
      "Divine": 10,
      "Omniversal": 3,
      "Transcendent": 5,
      "Celestial": 300,
      "Ancient": 200,
      "Mythic": 1500,
      "Steelbone": 200
    },
    cost: 25000000,
    luckBonus: 3000,
    spinRateBoost: 0.8,
    godwaveMultiplier: 8,
    overrideSpinCap: true
  }
};

  const gearDescriptions = {
  "Gear 1: Luck Amulet": "A simple amulet that increases your luck by 125%, making rare pulls more common and speeding up your spins by 25%.",
  "Gear 2: Fortune Ring": "A mystical ring that boosts your money earned per spin by 25%, turning small wins into bigger fortunes.",
  "Gear 3: Eccentric Engine": "A finely tuned device that increases your luck by 1000% and gives a 25% chance to upgrade rarities, accelerating your progress and spinning 15% faster.",
  "Gear 4: Seraphim Booster": "Harness the power of the Seraphim to multiply your 10th spin's payout by 40x and increase variant rarity by 25%, unlocking rarer variants.",
  "Gear 5: Lightspeed Obliterator": "Unleash blinding speed to boost your spin rate by 115% and gain a 25% temporary luck surge every third spin.",
  "Gear 6: 404 Glitcher": "Embrace the unpredictable with a gear that adds 50000% luck and can randomly boost (x5) or nerf (x0.5) your money on Glitched rarity pulls.",
  "Gear 7: Omnicore Reactor": "A powerful reactor that increases money earnings by 50%, boosts luck by 200%, and accelerates spin rate by 30%, pushing you closer to ultimate rarity.",
  "Gear 8: Eternity Processor": "An advanced processor that speeds up spins by 40%, increases variant chances by 35%, and boosts rare payouts by 60%.",
  "Gear 9: Genesis Drive": "The drive that controls genesis-level power, greatly enhancing luck by 400% and money multipliers by 300% for high-tier pulls.",
  "Gear 10: Paradox Core": "A core that manipulates paradoxes to protect you from glitches and unlock rare spin bonuses, increasing luck by 500% and spin speed by 50%.",
  "Gear 11: Godwave Singularity": "The pinnacle of all gear, granting massive luck boosts of 1000%, spin speed boosts of 150%, and unparalleled money multipliers up to 10x."
};

  // Keep inventory count of rarities and variants
  let inventory = {};
  // Keep track of unlocked gears
  let unlockedGears = {};
  // Total spins
  let totalSpins = 0;
  // Money
  let money = 0;
  // Luck from gears, starts at 0
  let currentLuck = 0;
  // Highest rarity pulled (for stats)
  let rarityOrder = Object.keys(baseRarities);
  let rarityRank = {};
  rarityOrder.forEach((r, i) => rarityRank[r] = i);
  let highestRarityPulled = null;

  // Auto-spin variables
  let autoSpinEnabled = false;
  let autoSpinInterval = null;

  const spinBtn = document.getElementById("spin-btn");
  const autoSpinBtn = document.getElementById("auto-spin-btn");
  const resultDiv = document.getElementById("result");
  const moneyDiv = document.getElementById("money");
  const statsDiv = document.getElementById("stats");
  const luckDiv = document.getElementById("luck");
  const gearListDiv = document.getElementById("gear-list");
  const autoSpinRateDiv = document.getElementById("auto-spin-rate");
  const rarityCountsDiv = document.getElementById("rarity-counts");
  const rarityListSelect = document.getElementById("rarity-list");
  const autoSpinRareThreshold = rarityRank["Reality-Bound"]; // Ancient and above
  
// === WEATHER SYSTEM ===

let currentWeather = null;

const weatherTypes = {
  "Mystic Storm": {
    duration: 60000,
    chance: 0.01,
    effectDescription: "Celestial is 25% more likely. Mystic variants are unlocked.",
    rarityBoost: { "Celestial": 0.25 },
    unlockVariants: ["Mystic"]
  },
  "Solar Flare": {
    duration: 45000,
    chance: 0.0075,
    effectDescription: "Ancient and Mythic increased. Unlocks Solar variants.",
    rarityBoost: { "Ancient": 0.2, "Mythic": 0.1 },
    unlockVariants: ["Solar"]
  },
  "Void Eclipse": {
    duration: 70000,
    chance: 0.0037,
    effectDescription: "Increased Glitched drop chance. Unlocks Void variants.",
    rarityBoost: { "Glitched": 5 },
    unlockVariants: ["Void"]
  },
  "Lucky Winds": {
    duration: 30000,
    chance: 0.015,
    effectDescription: "+20% global luck bonus.",
    globalLuckBoost: 0.2,
    unlockVariants: ["Windblessed"]
  }
};

// === WEATHER BANNER SETUP ===
const weatherBanner = document.createElement("div");
weatherBanner.style.position = "fixed";
weatherBanner.style.top = "10px";
weatherBanner.style.left = "50%";
weatherBanner.style.transform = "translateX(-50%)";
weatherBanner.style.padding = "8px 14px";
weatherBanner.style.borderRadius = "10px";
weatherBanner.style.background = "#222";
weatherBanner.style.color = "#fff";
weatherBanner.style.fontWeight = "bold";
weatherBanner.style.zIndex = "9999";
weatherBanner.style.fontSize = "14px";
weatherBanner.style.textAlign = "center";
document.body.appendChild(weatherBanner);

function updateWeatherBanner() {
  if (currentWeather) {
    weatherBanner.textContent = `üå©Ô∏è ${currentWeather.name} Active - ${currentWeather.effectDescription}`;
  } else {
    weatherBanner.textContent = "‚òÄÔ∏è No weather active";
  }
}

// === WEATHER LOGIC ===
function applyWeather(name) {
  const data = weatherTypes[name];
  if (!data) return;

  currentWeather = {
    name,
    ...data
  };
  updateWeatherBanner();

  setTimeout(() => {
    clearWeather();
  }, data.duration);
}

function clearWeather() {
  currentWeather = null;
  updateWeatherBanner();
}

// === WEATHER CHECK LOOP (Every 1s) ===
setInterval(() => {
  if (!currentWeather) {
    for (const [weatherName, weatherData] of Object.entries(weatherTypes)) {
      if (Math.random() < weatherData.chance) {
        applyWeather(weatherName);
        break; // only one weather at a time
      }
    }
  }
}, 1000);

// === Initialize Weather UI on Page Load ===
updateWeatherBanner();  
  // === Luck Upgrade System ===
let luckUpgradeLevel = 0;
let luckUpgradeBaseCost = 200;

function getLuckUpgradeCost() {
  return Math.floor(luckUpgradeBaseCost * Math.pow(1.75, luckUpgradeLevel));
}

function getLuckBonusFromUpgrade() {
  return luckUpgradeLevel * 0.1; // Each level = +10% luck
}

function updateLuckUpgradeUI() {
  document.getElementById("luck-upgrade-level").textContent = luckUpgradeLevel;
  document.getElementById("luck-upgrade-cost").textContent = getLuckUpgradeCost().toLocaleString();
}

// Buy Luck Upgrade logic
document.getElementById("buy-luck-upgrade").addEventListener("click", () => {
  const cost = getLuckUpgradeCost();
  if (money >= cost) {
    money -= cost;
    luckUpgradeLevel++;
    updateLuckUpgradeUI();
    moneyDiv.textContent = `Money: ${money}`;
    saveGame();
    checkGearsUnlock();
      luckDiv.textContent = `Luck Bonus from Gears: ${(currentLuck * 100 + getLuckBonusFromUpgrade() * 100).toFixed(2)}%`;
  }
});

  // Initialize rarity list in sidebar
// Helper: Format chance from weight
function formatChance(weight) {
  const totalWeight = Object.values(baseRarities).reduce((a,b) => a + b, 0);
  if (weight === 0) return "N/A";
  const chance = weight / totalWeight;
  const inv = Math.round(1 / chance);
  return `1/${inv.toLocaleString()}`;
}

// Initialize rarity list in sidebar with ??? for not pulled rarities
function initRarityList() {
  rarityListSelect.innerHTML = "";
  for (const rarity of rarityOrder) {
    const option = document.createElement("option");
    const pulledCount = getRarityCount(rarity);
    if (pulledCount === 0) {
      // Not pulled yet ‚Äî show ??? and chance
      option.textContent = `??? - ${formatChance(baseRarities[rarity])}`;
      option.className = "rarity-" + rarity.replace(/ /g,"-");
      option.style.fontStyle = "italic";
      option.style.color = "#999";
    } else {
      // Pulled ‚Äî show rarity name normally
      option.textContent = rarity;
      option.className = "rarity-" + rarity.replace(/ /g,"-");
      option.style.fontStyle = "";
      option.style.color = "";
    }
    rarityListSelect.appendChild(option);
  }
}

// Then, inside your spin() function, add this line near the end to refresh sidebar after each spin:
initRarityList();
function loadGame() {
  const saved = localStorage.getItem("supaSpinSave");
  if (saved) {
    const data = JSON.parse(saved);
    luckUpgradeLevel = data.luckUpgradeLevel || 0;
    inventory = data.inventory || {};
    unlockedGears = data.unlockedGears || {};
    totalSpins = data.totalSpins || 0;
    money = data.money || 0;
    highestRarityPulled = data.highestRarityPulled || null;
  }
}

// Load first
loadGame();

function weightedRandomRarity(extraLuck = 0) {
  const luckMultiplier = 1 + currentLuck + getLuckBonusFromUpgrade() + (extraLuck / 100);

  let weightedEntries = [];
  let totalWeight = 0;

  for (const [rarity, baseWeight] of Object.entries(baseRarities)) {
    let weight = baseWeight;

    // Apply luck multiplier to rarities above Legendary only
    if (rarityRank[rarity] >= rarityRank["Legendary"]) {
      weight = baseWeight * luckMultiplier;
    }

    weightedEntries.push({ rarity, weight });
    totalWeight += weight;
  }

  let randomWeight = Math.random() * totalWeight;
  for (const entry of weightedEntries) {
    if (randomWeight < entry.weight) return entry.rarity;
    randomWeight -= entry.weight;
  }

  return "Common";
  }

  // Weighted random helper for variants within rarity
  function weightedRandomVariant(rarity) {
  let variantList = variants[rarity];
  if (!variantList) return null;

  // Clone the variantList to avoid modifying original
  let combinedVariants = variantList.slice();

  // Add weather unlock variants if active and relevant
  if (window.currentWeather?.unlockVariants) {
    for (const weatherVariantName of window.currentWeather.unlockVariants) {
      // Check if this variant is already in the list to avoid duplicates
      if (!combinedVariants.some(v => v.name === weatherVariantName)) {
        combinedVariants.push({ name: weatherVariantName, weight: 1 }); // weight can be adjusted
      }
    }
  }

  // Calculate total weight
  let totalWeight = combinedVariants.reduce((acc, v) => acc + v.weight, 0);
  let rnd = Math.random() * totalWeight;

  for (const variant of combinedVariants) {
    if (rnd < variant.weight) return variant.name;
    rnd -= variant.weight;
  }

  return combinedVariants[0].name;
  }
  // Update inventory counts
  function addToInventory(rarity, variant) {
    if (!inventory[rarity]) inventory[rarity] = {};
    if (!inventory[rarity][variant]) inventory[rarity][variant] = 0;
    inventory[rarity][variant]++;
  }

  // Calculate total count of a rarity (all variants)
  function getRarityCount(rarity) {
    if (!inventory[rarity]) return 0;
    return Object.values(inventory[rarity]).reduce((a,b) => a+b, 0);
  }

  // Update the rarity counts display
// Precompute total weight of base rarities
const totalBaseWeight = Object.values(baseRarities).reduce((a,b) => a + b, 0);

// Helper to get chance denominator string "1/XYZ"
function getChanceDenominator(rarity) {
  const weight = baseRarities[rarity];
  if (!weight) return "?";
  const chance = weight / totalBaseWeight;
  return "1/" + Math.round(1 / chance);
}

function getRaritySpan(rarity) {
  const specialRarities = ["Steelbone", "Celestial", "Ancient"];
  if (specialRarities.includes(rarity)) {
    return `<span class="floating-particles rarity-${rarity.replace(/ /g, "-")}">${rarity}</span>`;
  } else {
    return `<span class="rarity-${rarity.replace(/ /g, "-")}">${rarity}</span>`;
  }
}

function updateInventoryDisplay() {
  let html = "";
  for (const rarity of rarityOrder) {
    const count = getRarityCount(rarity);
    const hasEverPulled = inventory[rarity] !== undefined;
    const rarityId = `rarity-${rarity.replace(/ /g, "-")}`;

    if (hasEverPulled) {
      // Player has seen this rarity ‚Äî show it, even if count is 0
      const displayCount = count > 0 ? count : 0;
      html += `
        <div class="${rarityId}" style="cursor:pointer; font-weight:bold; opacity: ${count > 0 ? 1 : 0.5};" onclick="toggleVariants('${rarityId}')">
          ‚ñ∂ <strong>${getRaritySpan(rarity)}</strong>: ${displayCount}
        </div>
        <div id="${rarityId}-variants" style="display:none; padding-left: 15px; font-size: 14px;">
          ${getVariantBreakdown(rarity)}
        </div>
      `;
    } else {
      // Player has never pulled this rarity
      const denom = getChanceDenominator(rarity);
      html += `
        <div class="rarity-unknown" style="font-style: italic; color: #999;">
          ??? - ${denom}
        </div>
      `;
    }
  }

  rarityCountsDiv.innerHTML = html || "Nothing pulled yet.";
}
  
function getVariantBreakdown(rarity) {
  if (!inventory[rarity]) return "None";
  let breakdown = "";
  // Determine variant color class based on rarity
  let variantClass = "";
  if (rarity === "Common") variantClass = "variant-common";
  else if (rarity === "Uncommon") variantClass = "variant-uncommon";
  else variantClass = "variant"; // default styling for others

  for (const [variant, count] of Object.entries(inventory[rarity])) {
    breakdown += `<div class="${variantClass}">${variant}: ${count}</div>`;
  }
  return breakdown;
}

function toggleVariants(id) {
  const el = document.getElementById(id + "-variants");
  if (el.style.display === "none") {
    el.style.display = "block";
  } else {
    el.style.display = "none";
  }
}
function checkRequirements(requirements) {
  for (const [rarity, needed] of Object.entries(requirements)) {
    if (getRarityCount(rarity) < needed) {
      return false;
    }
  }
  return true;
}

function checkGearsUnlock() {
  let unlockedCount = 0;
  currentLuck = 0;

  for (const [gearName, gearData] of Object.entries(gearRecipes)) {
    const hasRequirements = checkRequirements(gearData.requirements);

    // Auto-unlock if not already unlocked and requirements are met
    if (!unlockedGears[gearName] && hasRequirements) {
      unlockedGears[gearName] = true;
    }

    // Apply bonuses if unlocked
    if (unlockedGears[gearName]) {
      unlockedCount++;
      currentLuck += gearData.luckBonus || 0;
    }
  }

  updateGearListDisplay();
  moneyDiv.textContent = `Money: ${money.toLocaleString()}`;
  luckDiv.textContent = `Luck Bonus from Gears: ${(currentLuck * 100).toFixed(2)}%`;
  autoSpinBtn.disabled = unlockedCount === 0;
  saveGame();
}



  // Count how many gears unlocked
  function unlockedGearsCount() {
    return Object.values(unlockedGears).filter(Boolean).length;
  }

  // Update gear list display with progress bars
// Update gear list display with clickable gear names to show requirements
// Update gear list display with clickable gear names to show/hide requirements
// Track which gear's recipe is currently open
let openedGearName = null;

function updateGearListDisplay() {
  let html = "";

  for (const [gearName, gearData] of Object.entries(gearRecipes)) {
    const isUnlocked = unlockedGears[gearName];
    const description = gearDescriptions[gearName] || "No description available.";

    // Count current requirements progress
    let totalReq = 0;
    let currentCount = 0;
    let reqListHtml = "";

    for (const [reqRarity, reqCount] of Object.entries(gearData.requirements)) {
      totalReq += reqCount;
      const playerCount = getRarityCount(reqRarity);
      currentCount += Math.min(playerCount, reqCount);
      const color = playerCount >= reqCount ? "green" : "red";
      reqListHtml += `<div style="color:${color}">${reqCount} x ${reqRarity} (You have: ${playerCount})</div>`;
    }

    // Calculate progress percent
    const progress = totalReq > 0 ? (currentCount / totalReq) * 100 : 100;

    html += `
      <div class="gear-box" style="border:1px solid #888; margin-bottom:8px; padding:8px; border-radius:5px;">
        <div class="gear-title" style="cursor:pointer; user-select:none; font-weight:bold;" data-gear="${gearName}">
          ${gearName} ${isUnlocked ? "‚úÖ" : "‚ùå"}
        </div>

        <div class="gear-description" style="font-style: italic; color: #555; margin-bottom: 6px;">
          ${description}
        </div>

        <div class="gear-progress" style="background:#ddd; height:10px; border-radius:5px; margin:4px 0;">
          <div class="gear-progress-bar" style="background:#4caf50; height:100%; width: ${progress}%; border-radius:5px;"></div>
        </div>
        <div class="gear-status" style="font-size:14px; margin-bottom:4px;">
          ${isUnlocked ? `Unlocked! Luck +${(gearData.luckBonus*100).toFixed(1)}%` : `Progress: ${currentCount} / ${totalReq}`}
        </div>
        <div class="gear-requirements" style="display:none; padding-left:12px; font-size:13px; color:#333;">
          <strong>Requirements:</strong>
          ${reqListHtml}
        </div>
      </div>
    `;
  }

  gearListDiv.innerHTML = html || "No gears collected yet.";

  // Add click listeners to toggle requirement display
  document.querySelectorAll(".gear-title").forEach(titleEl => {
    titleEl.addEventListener("click", (event) => {
      event.stopPropagation();
      const gear = titleEl.dataset.gear;
      const box = titleEl.parentElement;
      const reqDiv = box.querySelector(".gear-requirements");

      if (reqDiv.style.display === "none") {
        // Close all others first
        document.querySelectorAll(".gear-requirements").forEach(div => {
          div.style.display = "none";
        });
        reqDiv.style.display = "block";
        openedGearName = gear;
      } else {
        reqDiv.style.display = "none";
        openedGearName = null;
      }
    });
  });

  // Restore open gear requirements after UI rebuild
  if (openedGearName) {
    const openReqDiv = document.querySelector(`.gear-title[data-gear="${openedGearName}"]`)?.parentElement.querySelector(".gear-requirements");
    if (openReqDiv) openReqDiv.style.display = "block";
  }
  }
// Clicking outside closes all open requirements
document.body.addEventListener("click", () => {
  document.querySelectorAll(".gear-requirements").forEach(reqDiv => {
    reqDiv.style.display = "none";
  });
  openedGearName = null;
});

// Enable auto-spin button from start
autoSpinBtn.disabled = false;

  // Spin function
  function spin() {
  saveGame();
  totalSpins++;

  // Base weighted rarity pick with luck included
  let rarity = weightedRandomRarity();
    // Money earned mapping
  const moneyMap = {
  "Cracked": 0.1,
  "Chipped": 0.25,
  "Broken": 0.5,
  "Basic": 0.75,
  "Dull": 0.9,
  "Tarnished": 1,
  "Common": 1.25,
  "Dusty": 1.5,
  "Uncommon": 3,
  "Firm": 4,
  "Polished": 5,
  "Refined": 6,
  "Rare": 7,
  "Steelbone": 9,
  "Epic": 12,
  "Legendary": 25,
  "Mythic": 40,
  "Ancient": 60,
  "Celestial": 100,
  "Transcendent": 200,
  "Omniversal": 350,
  "Divine": 500,
  "Phantom": 650,
  "Quantum": 800,
  "Astral": 1000,
  "Primordial": 1250,
  "Glitched": 1500,
  "Ethereal": 2000,
  "Reality-Bound": 5000,
  "Genesis": 10000
};

  // Apply weather rarity boost (if any)
  if (window.currentWeather && window.currentWeather.rarityBoost) {
    const boost = window.currentWeather.rarityBoost[rarity];
    if (boost) {
      // Here you can re-roll or increase chance.
      // Simplest: add chance boost by reselecting rarity with boosted weights
      rarity = weightedRandomRarityWithWeatherBoost(rarity, boost);
    }
  }
  
  let earned = moneyMap[rarity] || 1;

// Fortune Ring (flat money multiplier)
// Fortune Ring (flat money multiplier)
if (unlockedGears["Gear 2: Fortune Ring"]) {
  const bonus = gearRecipes["Gear 2: Fortune Ring"].moneyMultiplier || 0;
  earned *= (1 + bonus);
  
  // Only notify once
  if (!fortuneRingNotified) {
    showNotification(`üí∞ Fortune Ring: +${(bonus * 100).toFixed(0)}% Money!`, "#4caf50");
    fortuneRingNotified = true;
  }
}
  
  // Seraphim Booster (10th spin multiplier)
  if (totalSpins % 10 === 0 && unlockedGears["Gear 4: Seraphim Booster"]) {
    const multiplier = gearRecipes["Gear 4: Seraphim Booster"].tenthSpinMoneyMultiplier || 1;
    earned *= multiplier;
    showNotification(`üí• Tenth Spin Bonus x${multiplier}!`, "#ff9800");
  }
    
  // Lightspeed Obliterator (every 3rd spin = temporary luck boost)
let bonusLuck = 0;
if (unlockedGears["Gear 5: Lightspeed Obliterator"] && totalSpins % 3 === 0) {
  bonusLuck += gearRecipes["Gear 5: Lightspeed Obliterator"].thirdSpinLuckBoost || 0;
  showNotification(`‚ö° Lightspeed Bonus: +${bonusLuck}% Luck!`, "#00bcd4");
}
    
  // 404 Glitcher (random money boost or nerf on Glitched rarity)
  if (unlockedGears["Gear 6: 404 Glitcher"] && rarity === "Glitched") {
    const gearData = gearRecipes["Gear 6: 404 Glitcher"];
    if (Math.random() < (gearData.glitchMoneyBoostChance || 0)) {
      const positive = Math.random() < 0.5; // 50/50 chance for buff or nerf
      if (positive) {
        earned *= gearData.glitchMoneyMultiplierPositive || 1;
        showNotification(`üü™ 404 Glitcher Bonus x${gearData.glitchMoneyMultiplierPositive}!`, "#9c27b0");
      } else {
        earned *= gearData.glitchMoneyMultiplierNegative || 1;
        showNotification(`‚ö†Ô∏è 404 Glitcher Glitch: x${gearData.glitchMoneyMultiplierNegative}`, "#ff5252");
      }
    }
  }
  


// Existing gears you already have...

// Gear 7: Omnicore Reactor
if (unlockedGears["Gear 7: Omnicore Reactor"]) {
  const mult = gearRecipes["Gear 7: Omnicore Reactor"].moneyMultiplier || 0;
  earned *= (1 + mult);
  showNotification(`üîÜ Omnicore Reactor +${(mult * 100).toFixed(0)}% Money!`, "#ffa726");
}

// Gear 8: Eternity Processor (10th spin multiplier)
if (unlockedGears["Gear 8: Eternity Processor"] && totalSpins % 10 === 0) {
  const mult = gearRecipes["Gear 8: Eternity Processor"].tenthSpinMoneyMultiplier || 1;
  earned *= mult;
  showNotification(`‚ôæÔ∏è Eternity Boost x${mult}!`, "#5c6bc0");
}

// Gear 9: Genesis Drive (random luck boost)
if (unlockedGears["Gear 9: Genesis Drive"] && Math.random() < (gearRecipes["Gear 9: Genesis Drive"].bonusLuckChance || 0)) {
  bonusLuck += 1.0; // +100% luck temporarily
  showNotification("üåå Genesis Surge: +100% Luck!", "#673ab7");
}

// Gear 10: Paradox Core (5% chance to duplicate earned money)
if (unlockedGears["Gear 10: Paradox Core"] && Math.random() < (gearRecipes["Gear 10: Paradox Core"].paradoxSpinChance || 0)) {
  money += earned; // duplicate money gain
  showNotification("üåÄ Paradox Echo: Spin Duplicated!", "#00acc1");
}

// Gear 11: Godwave Singularity (every 50th spin x10 money)
if (unlockedGears["Gear 11: Godwave Singularity"] && totalSpins % 50 === 0) {
  const mult = gearRecipes["Gear 11: Godwave Singularity"].godwaveMultiplier || 1;
  earned *= mult;
  showNotification(`üå† Godwave Blast: x${mult} Money!`, "#ffeb3b");
}

money += earned;

  // Auto-spin interruption logic
  if (autoSpinEnabled && rarityRank[rarity] >= autoSpinRareThreshold) {
    clearInterval(autoSpinInterval);
    autoSpinInterval = null;
    autoSpinEnabled = false;
    autoSpinBtn.textContent = "Auto Spin: (Rare pull!)";
    spinBtn.disabled = false;

    // Optional: Play rare pull sound here
    // new Audio("your-raresound.mp3").play();

    setTimeout(() => {
      if (!autoSpinEnabled) {
        startAutoSpin();
      }
    }, 3000);
  }

  // Pick variant normally
  let variant = weightedRandomVariant(rarity);

  // If current weather unlocks variants for this rarity, boost chance for those
  if (window.currentWeather && window.currentWeather.unlockVariants) {
    const unlockedVariants = window.currentWeather.unlockVariants;
    if (!variant || !unlockedVariants.includes(variant)) {
      // Try to pick a variant from unlocked list if any exist
      const variantsForRarity = variants[rarity] || [];
      const filtered = variantsForRarity.filter(v => unlockedVariants.includes(v.name));
      if (filtered.length > 0) {
        variant = filtered[Math.floor(Math.random() * filtered.length)].name;
      }
    }
  }

  // Add to inventory
  addToInventory(rarity, variant);

  // Update highest rarity pulled
  if (!highestRarityPulled || rarityRank[rarity] > rarityRank[highestRarityPulled]) {
    highestRarityPulled = rarity;
  }
  
  function getChanceDenominator(rarity) {
  const rate = baseRarities[rarity];
  if (!rate || rate <= 0) return "?";
  return Math.round(1 / rate).toLocaleString(); // Adds commas for large numbers
}
// Your spin function or wherever you update UI after a spin
function updateSpinResultUI(rarity, variant, earned, money, totalSpins, highestRarityPulled) {
  resultDiv.innerHTML = `You spun: <span class="rarity-${rarity.replace(/ /g, "-")}">${rarity} (1/${getChanceDenominator(rarity)})</span> <span class="variant">${variant}</span><br>Money earned: ${earned}`;
  moneyDiv.textContent = `Money: ${money}`;
  statsDiv.innerHTML = `Total Spins: ${totalSpins}<br>Rarest Pull: <span class="rarity-${(highestRarityPulled || "Common").replace(/ /g, "-")}">${highestRarityPulled || "N/A"}</span>`;
  updateInventoryDisplay();
}


    // Update UI
    updateSpinResultUI(rarity, variant, earned, money, totalSpins, highestRarityPulled);

    
    // Helper function for rarity re-roll with weather boost
function weightedRandomRarityWithWeatherBoost(baseRarity, boost) {
  // Create adjusted chances applying boost to baseRarity
  const baseChances = getBaseRarityChances(); // Implement this to get base chances map

  // Increase boosted rarity chance by multiplying its weight
  let adjustedChances = { ...baseChances };
  if (adjustedChances[baseRarity]) {
    adjustedChances[baseRarity] *= (1 + boost);
  }

  // Normalize chances
  const total = Object.values(adjustedChances).reduce((a,b) => a+b, 0);
  for (const r in adjustedChances) {
    adjustedChances[r] /= total;
  }

  // Weighted random selection
  let rand = Math.random();
  let cumulative = 0;
  for (const [r, chance] of Object.entries(adjustedChances)) {
    cumulative += chance;
    if (rand <= cumulative) return r;
  }

  return baseRarity; // fallback
}

    // Check if any gears can unlock now
    checkGearsUnlock();
  }
  
  function saveGame() {
  const gameData = {
    inventory,
    unlockedGears,
    totalSpins,
    money,
    luckUpgradeLevel,
    highestRarityPulled
  };
  localStorage.setItem("supaSpinSave", JSON.stringify(gameData));
}

  spinBtn.addEventListener("click", spin);

  function startAutoSpin() {
  let baseInterval = 200;
  let totalBoost = 0;

  // Sum spinRateBoost from all unlocked gears
  for (const gearName in unlockedGears) {
    if (unlockedGears[gearName]) {
      totalBoost += gearRecipes[gearName].spinRateBoost || 0;
    }
  }

  // Cap total boost to 90%
  totalBoost = Math.min(totalBoost, 250);

  // Update on-screen spin boost display
  const boostPercent = (totalBoost * 100).toFixed(1);
  const spinBoostDiv = document.getElementById("spinBoostDisplay");
  if (spinBoostDiv) {
    spinBoostDiv.textContent = `Spin Speed Boost: ${boostPercent}%`;
  }

  // Calculate interval with boost
  let interval = baseInterval * (1 - totalBoost);
  interval = Math.max(interval, 50);

  if (autoSpinInterval) clearInterval(autoSpinInterval);
  autoSpinInterval = setInterval(spin, interval);

  autoSpinEnabled = true;
  autoSpinBtn.textContent = "Auto Spin: ON";
  spinBtn.disabled = true;
  }

function stopAutoSpin(reason = "OFF") {
  clearInterval(autoSpinInterval);
  autoSpinInterval = null;
  autoSpinEnabled = false;
  autoSpinBtn.textContent = `Auto Spin: ${reason}`;
  spinBtn.disabled = false;

  const spinBoostDiv = document.getElementById("spinBoostDisplay");
  if (spinBoostDiv) {
    spinBoostDiv.textContent = `Spin Speed Boost: 0%`;
  }
}

autoSpinBtn.addEventListener("click", () => {
  if (autoSpinEnabled) stopAutoSpin("OFF");
  else startAutoSpin();
});
// Your existing setup and initialization code, e.g.:
// initRarityList();
// updateGearListDisplay();
// updateInventoryDisplay();
// etc...

// Now add secret code handler after the UI elements exist
const secretCode = "yopapa"; // Change to your private dev code

document.getElementById("secretCodeSubmit").addEventListener("click", () => {
  const input = document.getElementById("secretCodeInput").value.trim();
  const msgEl = document.getElementById("secretCodeMessage");

  if (input === secretCode) {
    // Unlock all gears
    for (const gearName of Object.keys(gearRecipes)) {
      unlockedGears[gearName] = true;
    }

    updateGearListDisplay();

    msgEl.style.color = "green";
    msgEl.textContent = "‚úÖ All gears unlocked!";
  } else {
    msgEl.style.color = "red";
    msgEl.textContent = "‚ùå Invalid code.";
  }

  document.getElementById("secretCodeInput").value = "";
});
  // Initialize
  initRarityList();
  updateGearListDisplay();
  updateInventoryDisplay();
  updateLuckUpgradeUI();
  luckDiv.textContent = "Luck Bonus from Gears: 0%";

</script>
</body>
</html>
