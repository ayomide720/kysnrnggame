<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Advanced Spin Game</title>
<style>  
  body {  
    background: #f0f2f5;  
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
    display: flex;  
    flex-direction: row;  
    align-items: flex-start;  
    padding: 30px;  
    min-height: 100vh;  
    margin: 0;  
    gap: 30px;  
  }  
  main {  
    flex: 1;  
    max-width: 600px;
  }  
  h1 {  
    margin-bottom: 10px;  
  }  
  button {  
    padding: 12px 30px;  
    font-size: 18px;  
    border: none;  
    border-radius: 8px;  
    background-color: #111;  
    color: white;  
    cursor: pointer;  
    margin: 10px 10px 10px 0;  
  }  
  #result, #stats, #money, #gears, #luck {  
    margin-top: 20px;  
    width: 100%;  
    padding: 15px 20px;  
    border-radius: 12px;  
    background: white;  
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);  
    font-size: 16px;  
    text-align: center;  
  }  

  /* Rarity Colors */  
  .rarity-Common        { color: #666; }  
  .rarity-Uncommon      { color: #2ecc71; }  
  .rarity-Rare          { color: #3498db; }  
  .rarity-Epic          { color: #9b59b6; }  
  .rarity-Legendary     { color: #f1c40f; }  
  .rarity-Mythic        { color: #e67e22; }  
  .rarity-Ancient       { color: #d35400; }  
  .rarity-Celestial     { color: #1abc9c; }  
  .rarity-Transcendent  { color: #e91e63; }  
  .rarity-Omniversal    { color: #ff0000; font-weight: bold; }  
  .rarity-Divine        { color: gold; }  
  .rarity-Phantom       { color: slateblue; }  
  .rarity-Quantum       { color: darkcyan; }  
  .rarity-Astral        { color: mediumorchid; }  
  .rarity-Glitched      { color: darkred; }  
  .rarity-Primordial    { color: teal; font-weight: bold; }  
  .rarity-Ethereal      { color: #a29bfe; font-style: italic; }  
  .rarity-Reality-Bound { color: #8e44ad; font-weight: bold; }  
  .rarity-Genesis       { color: #000; background: #fff; padding: 2px 6px; border-radius: 6px; }  

  .variant {  
    font-style: italic;  
    margin-left: 5px;  
    padding: 2px 6px;  
    border-radius: 5px;  
    background: #eee;  
    font-weight: 600;  
    user-select: none;  
  }
  /* Sidebar dropdown styling */
  #sidebar {
    width: 250px;
    background: white;
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
  }
  label {
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
  }
  select {
    width: 100%;
    font-size: 16px;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    margin-bottom: 15px;
    cursor: pointer;
  }
    #gear-panel {
  width: 300px;
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
}
#inventory-display {
  margin-top: 20px;
  padding: 15px;
  border-radius: 12px;
  background: white;
  box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
}
#rarity-counts {
  font-size: 15px;
  line-height: 1.6;
  text-align: left;
}

.gear-box {
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

.gear-title {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 8px;
}

.gear-progress {
  height: 18px;
  background: #ddd;
  border-radius: 10px;
  overflow: hidden;
  margin: 6px 0;
}

.gear-progress-bar {
  height: 100%;
  background: linear-gradient(to right, #4caf50, #2ecc71);
  width: 0%;
  transition: width 0.3s ease;
  color: white;
  font-size: 12px;
  text-align: center;
  line-height: 18px;
}

.gear-status {
  font-size: 14px;
  margin-top: 5px;
}
</style>
</head>
<body>

<main>
  <h1>üé∞ Advanced Spin Game</h1>
  <button id="spin-btn">Spin</button>
  <button id="auto-spin-btn" disabled>Auto Spin: OFF</button>

  <div id="result">Your result will appear here.</div>
  <div id="money">Money: 0</div>
  <div id="stats">Total Spins: 0<br>Rarest Pull: N/A</div>
  <div id="luck">Luck Bonus from Gears: 0%</div>
  <div id="gears">
    <h3>Gear Status</h3>
    <div id="gear-list">No gears collected yet.</div>
    <div id="inventory-display">
      <h3>Your Rarity Inventory</h3>
      <div id="rarity-counts">Nothing pulled yet.</div>
    </div>
  </div>
</main>

<div id="sidebar">
  <label for="rarity-list">All Rarities</label>
  <select id="rarity-list" size="16" readonly>
    <!-- Options populated by JS -->
  </select>
</div>

<script>
  // Base rarity weights (higher number = more common)
  // Rarities above Celestial are 5x rarer (weights divided by 5)
  const baseRarities = {
    "Common": 10000,
    "Uncommon": 5000,
    "Rare": 2000,
    "Epic": 1000,
    "Legendary": 500,
    "Mythic": 200,
    "Ancient": 100,
    "Celestial": 50,
    "Transcendent": 10 / 5,
    "Omniversal": 5 / 5,
    "Divine": 7 / 5,
    "Phantom": 12 / 5,
    "Quantum": 15 / 5,
    "Astral": 20 / 5,
    "Glitched": 25 / 5
  };

  const variants = {
    "Common": [
      {name:"Rusty", weight: 40},
      {name:"Dusty", weight: 30},
      {name:"Basic", weight: 50},
      {name:"Worn", weight: 20},
      {name:"Scratched", weight: 10},
      {name:"Faded", weight: 35},
      {name:"Plain", weight: 45}
    ],
    "Uncommon": [
      {name:"Polished", weight: 50},
      {name:"Light-Tinted", weight: 25},
      {name:"Improved", weight: 20},
      {name:"Fine", weight: 15},
      {name:"Refined", weight: 10}
    ],
    "Rare": [
      {name:"Shiny", weight: 35},
      {name:"Steel-Plated", weight: 25},
      {name:"Neat", weight: 20},
      {name:"Glow-Edge", weight: 15},
      {name:"Sharp", weight: 10}
    ],
    "Epic": [
      {name:"Crimson", weight: 30},
      {name:"Shadow-Forged", weight: 20},
      {name:"Holy", weight: 15},
      {name:"Void-Touched", weight: 10},
      {name:"Spiked", weight: 5}
    ],
    "Legendary": [
      {name:"Dragoncore", weight: 25},
      {name:"Arcane-Blade", weight: 20},
      {name:"Royal", weight: 15},
      {name:"Phoenix", weight: 10},
      {name:"Duskborne", weight: 5}
    ],
    "Mythic": [
      {name:"Ethereal", weight: 20},
      {name:"Twilightborn", weight: 15},
      {name:"Spiritforged", weight: 10},
      {name:"Hellfire", weight: 7},
      {name:"Radiant", weight: 3}
    ],
    "Ancient": [
      {name:"Relic-Bound", weight: 20},
      {name:"Time-Worn", weight: 15},
      {name:"Forgotten", weight: 10},
      {name:"Runic", weight: 8},
      {name:"Ruined", weight: 5}
    ],
    "Celestial": [
      {name:"Starforged", weight: 15},
      {name:"Void-Dancer", weight: 10},
      {name:"Cometfall", weight: 8},
      {name:"Skylit", weight: 5},
      {name:"Galaxian", weight: 3}
    ],
    "Transcendent": [
      {name:"God-Touched", weight: 12},
      {name:"Echoed Soul", weight: 8},
      {name:"Lightbane", weight: 6},
      {name:"Fate-Warped", weight: 4},
      {name:"Dimensional", weight: 2}
    ],
    "Omniversal": [
      {name:"Origin", weight: 8},
      {name:"True Form", weight: 5},
      {name:"Undefined", weight: 4},
      {name:"Nullborn", weight: 2},
      {name:"Singularity", weight: 1}
    ],
    "Divine": [
      {name:"Purelight", weight: 10},
      {name:"Heaven's Kiss", weight: 7},
      {name:"Blessed", weight: 5},
      {name:"Immortal", weight: 3},
      {name:"Sacred", weight: 1}
    ],
    "Phantom": [
      {name:"Ghostblade", weight: 10},
      {name:"Wraith-Edge", weight: 7},
      {name:"Spectral", weight: 5},
      {name:"Eclipsed", weight: 3},
      {name:"Soulshadow", weight: 1}
    ],
    "Quantum": [
      {name:"Entangled", weight: 10},
      {name:"Superposed", weight: 7},
      {name:"Uncertain", weight: 5},
      {name:"Collapsed", weight: 3},
      {name:"Photon", weight: 1}
    ],
    "Astral": [
      {name:"Starborn", weight: 10},
      {name:"Celestine", weight: 7},
      {name:"Nebula", weight: 5},
      {name:"Lunar", weight: 3},
      {name:"Solar", weight: 1}
    ],
    "Glitched": [
      {name:"Corrupted", weight: 10},
      {name:"Broken", weight: 7},
      {name:"Fragmented", weight: 5},
      {name:"Glitched-Out", weight: 3},
      {name:"Bugged", weight: 1}
    ]
  };

  // Gear recipes: each gear requires certain counts of rarities to unlock
  const gearRecipes = {
     "Gear 1: Luck Amulet": {
      requirements: { "Legendary": 20, "Epic": 45, "Celestial": 1 },
      luckBonus: 0.5, // 50% luck
      spinRateBoost: 0.15 // 15% faster autospin
    },
    "Gear 2: Fortune Ring": {
      requirements: { "Mythic": 10, "Ancient": 15, "Celestial": 3 },
      luckBonus: 0.10
    },
    "Gear 3: Destiny Crown": {
      requirements: { "Transcendent": 5, "Omniversal": 2, "Divine": 1 },
      luckBonus: 0.15
    },
    "Gear 4: Eternity Band": {
      requirements: { "Phantom": 3, "Quantum": 4, "Astral": 3 },
      luckBonus: 0.20
    },
    "Gear 5: Reality Shard": {
      requirements: { "Glitched": 5, "Primordial": 2, "Ethereal": 3 },
      luckBonus: 0.25
    }
  };

  // Keep inventory count of rarities and variants
  let inventory = {};
  // Keep track of unlocked gears
  let unlockedGears = {};
  // Total spins
  let totalSpins = 0;
  // Money
  let money = 0;
  // Luck from gears, starts at 0
  let currentLuck = 0;
  // Highest rarity pulled (for stats)
  let rarityOrder = Object.keys(baseRarities);
  let rarityRank = {};
  rarityOrder.forEach((r, i) => rarityRank[r] = i);
  let highestRarityPulled = null;

  // Auto-spin variables
  let autoSpinEnabled = false;
  let autoSpinInterval = null;

  const spinBtn = document.getElementById("spin-btn");
  const autoSpinBtn = document.getElementById("auto-spin-btn");
  const resultDiv = document.getElementById("result");
  const moneyDiv = document.getElementById("money");
  const statsDiv = document.getElementById("stats");
  const luckDiv = document.getElementById("luck");
  const gearListDiv = document.getElementById("gear-list");
  const rarityCountsDiv = document.getElementById("rarity-counts");
  const rarityListSelect = document.getElementById("rarity-list");

  // Initialize rarity list in sidebar
  function initRarityList() {
    rarityListSelect.innerHTML = "";
    for (const rarity of rarityOrder) {
      const option = document.createElement("option");
      option.textContent = rarity;
      option.className = "rarity-" + rarity.replace(/ /g,"-");
      rarityListSelect.appendChild(option);
    }
  }

  // Weighted random helper for selecting rarity based on base weights + luck
  function weightedRandomRarity() {
    // Sum weights with luck applied only if at least one gear unlocked
    const luckMultiplier = unlockedGearsCount() > 0 ? 1 + currentLuck : 1;

    let weightedEntries = [];
    let totalWeight = 0;
    for (const [rarity, baseWeight] of Object.entries(baseRarities)) {
      // Apply luck multiplier to rarities above Legendary only (to make them easier)
      let weight = baseWeight;
      if (rarityRank[rarity] >= rarityRank["Legendary"]) {
        weight = baseWeight * luckMultiplier;
      }
      weightedEntries.push({rarity, weight});
      totalWeight += weight;
    }
    let randomWeight = Math.random() * totalWeight;
    for (const entry of weightedEntries) {
      if (randomWeight < entry.weight) return entry.rarity;
      randomWeight -= entry.weight;
    }
    // fallback
    return "Common";
  }

  // Weighted random helper for variants within rarity
  function weightedRandomVariant(rarity) {
    const variantList = variants[rarity];
    if (!variantList) return null;
    let totalWeight = variantList.reduce((acc,v) => acc + v.weight, 0);
    let rnd = Math.random() * totalWeight;
    for (const variant of variantList) {
      if (rnd < variant.weight) return variant.name;
      rnd -= variant.weight;
    }
    return variantList[0].name;
  }

  // Update inventory counts
  function addToInventory(rarity, variant) {
    if (!inventory[rarity]) inventory[rarity] = {};
    if (!inventory[rarity][variant]) inventory[rarity][variant] = 0;
    inventory[rarity][variant]++;
  }

  // Calculate total count of a rarity (all variants)
  function getRarityCount(rarity) {
    if (!inventory[rarity]) return 0;
    return Object.values(inventory[rarity]).reduce((a,b) => a+b, 0);
  }

  // Update the rarity counts display
  function updateInventoryDisplay() {
    let html = "";
    for (const rarity of rarityOrder) {
      const count = getRarityCount(rarity);
      if (count > 0) {
        html += `<div class="rarity-${rarity.replace(/ /g,"-")}"><strong>${rarity}</strong>: ${count}</div>`;
      }
    }
    rarityCountsDiv.innerHTML = html || "Nothing pulled yet.";
  }

  // Check gear unlock status and update unlocked gears and luck bonus
  function checkGearsUnlock() {
    let unlockedCount = 0;
    currentLuck = 0;
    for (const [gearName, gearData] of Object.entries(gearRecipes)) {
      let canUnlock = true;
      for (const [reqRarity, reqCount] of Object.entries(gearData.requirements)) {
        if (getRarityCount(reqRarity) < reqCount) {
          canUnlock = false;
          break;
        }
      }
      if (canUnlock) {
        if (!unlockedGears[gearName]) {
          unlockedGears[gearName] = true;
          unlockedCount++;
        } else {
          unlockedCount++;
        }
        currentLuck += gearData.luckBonus;
      } else {
        unlockedGears[gearName] = false;
      }
    }
    updateGearListDisplay();
    luckDiv.textContent = `Luck Bonus from Gears: ${(currentLuck*100).toFixed(2)}%`;
    // Enable auto-spin button if at least one gear unlocked
    autoSpinBtn.disabled = unlockedCount === 0;
  }

  // Count how many gears unlocked
  function unlockedGearsCount() {
    return Object.values(unlockedGears).filter(Boolean).length;
  }

  // Update gear list display with progress bars
// Update gear list display with clickable gear names to show requirements
function updateGearListDisplay() {
  let html = "";
  for (const [gearName, gearData] of Object.entries(gearRecipes)) {
    const isUnlocked = unlockedGears[gearName];
    let progress = 0;
    let totalReq = 0;
    let currentCount = 0;
    for (const [reqRarity, reqCount] of Object.entries(gearData.requirements)) {
      totalReq += reqCount;
      currentCount += Math.min(getRarityCount(reqRarity), reqCount);
    }
    progress = totalReq === 0 ? 0 : (currentCount / totalReq) * 100;

    // Build requirements list html
    let reqListHtml = '<ul style="text-align:left; margin-top:5px; margin-bottom:5px;">';
    for (const [reqRarity, reqCount] of Object.entries(gearData.requirements)) {
      const playerCount = getRarityCount(reqRarity);
      const color = playerCount >= reqCount ? "green" : "red";
      reqListHtml += `<li><span style="color:${color}">${reqRarity}: ${playerCount} / ${reqCount}</span></li>`;
    }
    reqListHtml += "</ul>";

    html += `
      <div class="gear-box">
        <div class="gear-title" style="cursor:pointer; user-select:none;" data-gear="${gearName}">
          ${gearName} ${isUnlocked ? "‚úÖ" : "‚ùå"}
        </div>
        <div class="gear-progress">
          <div class="gear-progress-bar" style="width: ${progress}%;"></div>
        </div>
        <div class="gear-status">
          ${isUnlocked ? "Unlocked! Luck +" + (gearData.luckBonus*100).toFixed(1) + "%" : `Progress: ${currentCount}/${totalReq}`}
        </div>
        <div class="gear-requirements" style="display:none; padding-left:10px; font-size:14px;">
          <strong>Requirements:</strong>
          ${reqListHtml}
        </div>
      </div>`;
  }
  gearListDiv.innerHTML = html || "No gears collected yet.";

  // Add click listeners to toggle requirements
  document.querySelectorAll(".gear-title").forEach(titleEl => {
    titleEl.addEventListener("click", () => {
      const box = titleEl.parentElement;
      const reqDiv = box.querySelector(".gear-requirements");
      if (reqDiv.style.display === "none") {
        reqDiv.style.display = "block";
      } else {
        reqDiv.style.display = "none";
      }
    });
  });
}

// Enable auto-spin button from start
autoSpinBtn.disabled = false;

  // Spin function
  function spin() {
    totalSpins++;
    // Get rarity weighted by luck
    const rarity = weightedRandomRarity();
    // Get variant
    const variant = weightedRandomVariant(rarity);
    // Add to inventory
    addToInventory(rarity, variant);

    // Update highest rarity pulled if needed
    if (!highestRarityPulled || rarityRank[rarity] > rarityRank[highestRarityPulled]) {
      highestRarityPulled = rarity;
    }

    // Calculate money earned (just example formula)
    // More rare = more money, common = 1, uncommon = 3, rare = 7, etc
    const moneyMap = {
      "Common": 1,
      "Uncommon": 3,
      "Rare": 7,
      "Epic": 12,
      "Legendary": 25,
      "Mythic": 40,
      "Ancient": 60,
      "Celestial": 100,
      "Transcendent": 200,
      "Omniversal": 350,
      "Divine": 500,
      "Phantom": 650,
      "Quantum": 800,
      "Astral": 1000,
      "Glitched": 1500
    };
    const earned = moneyMap[rarity] || 1;
    money += earned;

    // Update UI
    resultDiv.innerHTML = `You spun: <span class="rarity-${rarity.replace(/ /g,"-")}">${rarity}</span> <span class="variant">${variant}</span><br>Money earned: ${earned}`;
    moneyDiv.textContent = `Money: ${money}`;
    statsDiv.innerHTML = `Total Spins: ${totalSpins}<br>Rarest Pull: <span class="rarity-${highestRarityPulled?.replace(/ /g,"-") || "Common"}">${highestRarityPulled || "N/A"}</span>`;
    updateInventoryDisplay();

    // Check if any gears can unlock now
    checkGearsUnlock();
  }

  spinBtn.addEventListener("click", spin);

  autoSpinBtn.addEventListener("click", () => {
    if (autoSpinEnabled) {
      clearInterval(autoSpinInterval);
      autoSpinEnabled = false;
      autoSpinBtn.textContent = "Auto Spin: OFF";
      spinBtn.disabled = false;
    } else {
      let interval = 200;
if (unlockedGears["Gear 1: Luck Amulet"]) {
  interval *= (1 - (gearRecipes["Gear 1: Luck Amulet"].spinRateBoost || 0));
}
autoSpinInterval = setInterval(spin, interval);
      autoSpinEnabled = true;
      autoSpinBtn.textContent = "Auto Spin: ON";
      spinBtn.disabled = false;
    }
  });

  // Initialize
  initRarityList();
  updateGearListDisplay();
  updateInventoryDisplay();
  luckDiv.textContent = "Luck Bonus from Gears: 0%";

</script>
</body>
</html>